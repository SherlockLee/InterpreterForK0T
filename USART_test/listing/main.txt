; generated by ARM C/C++ Compiler, 4.1 [Build 644]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\main.o --asm_dir=.\listing\ --list_dir=.\listing\ --depend=.\obj\main.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\..\library\inc -I..\..\library\src -I..\uvsion -If:\Keil\ARM\CMSIS\Include -If:\Keil\ARM\INC\ST\STM32F10x -D__MICROLIB --omf_browse=.\obj\main.crf main.c]
                          THUMB

                          AREA ||i.GPIO_Configuration||, CODE, READONLY, ALIGN=2

                  GPIO_Configuration PROC
;;;906    *******************************************************************************/
;;;907    void GPIO_Configuration(void)
000000  b508              PUSH     {r3,lr}
;;;908    {
;;;909      GPIO_InitTypeDef GPIO_InitStructure;
;;;910    
;;;911      /* Configure USART1 Tx (PA.09) as alternate function push-pull */
;;;912      GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
000002  f44f7000          MOV      r0,#0x200
000006  f8ad0000          STRH     r0,[sp,#0]
;;;913      GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
00000a  f04f0018          MOV      r0,#0x18
00000e  f88d0003          STRB     r0,[sp,#3]
;;;914      GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000012  f04f0003          MOV      r0,#3
000016  f88d0002          STRB     r0,[sp,#2]
;;;915      GPIO_Init(GPIOA, &GPIO_InitStructure);
00001a  4669              MOV      r1,sp
00001c  4807              LDR      r0,|L1.60|
00001e  f7fffffe          BL       GPIO_Init
;;;916        
;;;917      /* Configure USART1 Rx (PA.10) as input floating */
;;;918      GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;
000022  f44f6080          MOV      r0,#0x400
000026  f8ad0000          STRH     r0,[sp,#0]
;;;919      GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
00002a  f04f0004          MOV      r0,#4
00002e  f88d0003          STRB     r0,[sp,#3]
;;;920      GPIO_Init(GPIOA, &GPIO_InitStructure);
000032  4669              MOV      r1,sp
000034  4801              LDR      r0,|L1.60|
000036  f7fffffe          BL       GPIO_Init
;;;921    }
00003a  bd08              POP      {r3,pc}
;;;922    
                          ENDP

                  |L1.60|
                          DCD      0x40010800

                          AREA ||i.NVIC_Configuration||, CODE, READONLY, ALIGN=1

                  NVIC_Configuration PROC
;;;888    *******************************************************************************/
;;;889    void NVIC_Configuration(void)
000000  b510              PUSH     {r4,lr}
;;;890    {
;;;891    #ifdef  VECT_TAB_RAM  
;;;892      /* Set the Vector Table base location at 0x20000000 */ 
;;;893      NVIC_SetVectorTable(NVIC_VectTab_RAM, 0x0); 
;;;894    #else  /* VECT_TAB_FLASH  */
;;;895      /* Set the Vector Table base location at 0x08000000 */ 
;;;896      NVIC_SetVectorTable(NVIC_VectTab_FLASH, 0x0);   
000002  2100              MOVS     r1,#0
000004  f04f6000          MOV      r0,#0x8000000
000008  f7fffffe          BL       NVIC_SetVectorTable
;;;897    #endif
;;;898    }
00000c  bd10              POP      {r4,pc}
;;;899    
                          ENDP


                          AREA ||i.RCC_Configuration||, CODE, READONLY, ALIGN=2

                  RCC_Configuration PROC
;;;830    *******************************************************************************/
;;;831    void RCC_Configuration(void)
000000  b510              PUSH     {r4,lr}
;;;832    {
;;;833      /* RCC system reset(for debug purpose) */
;;;834      RCC_DeInit();
000002  f7fffffe          BL       RCC_DeInit
;;;835    
;;;836      /* Enable HSE */
;;;837      RCC_HSEConfig(RCC_HSE_ON);
000006  f44f3080          MOV      r0,#0x10000
00000a  f7fffffe          BL       RCC_HSEConfig
;;;838    
;;;839      /* Wait till HSE is ready */
;;;840      HSEStartUpStatus = RCC_WaitForHSEStartUp();
00000e  f7fffffe          BL       RCC_WaitForHSEStartUp
000012  4919              LDR      r1,|L3.120|
000014  7008              STRB     r0,[r1,#0]
;;;841    
;;;842      if(HSEStartUpStatus == SUCCESS)
000016  4608              MOV      r0,r1
000018  7800              LDRB     r0,[r0,#0]  ; HSEStartUpStatus
00001a  2801              CMP      r0,#1
00001c  d126              BNE      |L3.108|
;;;843      {
;;;844        /* HCLK = SYSCLK */
;;;845        RCC_HCLKConfig(RCC_SYSCLK_Div1); 
00001e  2000              MOVS     r0,#0
000020  f7fffffe          BL       RCC_HCLKConfig
;;;846      
;;;847        /* PCLK2 = HCLK */
;;;848        RCC_PCLK2Config(RCC_HCLK_Div1); 
000024  2000              MOVS     r0,#0
000026  f7fffffe          BL       RCC_PCLK2Config
;;;849    
;;;850        /* PCLK1 = HCLK/2 */
;;;851        RCC_PCLK1Config(RCC_HCLK_Div2);
00002a  f44f6080          MOV      r0,#0x400
00002e  f7fffffe          BL       RCC_PCLK1Config
;;;852    
;;;853        /* Flash 2 wait state */
;;;854        FLASH_SetLatency(FLASH_Latency_2);
000032  2002              MOVS     r0,#2
000034  f7fffffe          BL       FLASH_SetLatency
;;;855        /* Enable Prefetch Buffer */
;;;856        FLASH_PrefetchBufferCmd(FLASH_PrefetchBuffer_Enable);
000038  2010              MOVS     r0,#0x10
00003a  f7fffffe          BL       FLASH_PrefetchBufferCmd
;;;857    
;;;858        /* PLLCLK = 8MHz * 9 = 72 MHz */
;;;859        RCC_PLLConfig(RCC_PLLSource_HSE_Div1, RCC_PLLMul_9);
00003e  f44f11e0          MOV      r1,#0x1c0000
000042  f44f3080          MOV      r0,#0x10000
000046  f7fffffe          BL       RCC_PLLConfig
;;;860    
;;;861        /* Enable PLL */ 
;;;862        RCC_PLLCmd(ENABLE);
00004a  2001              MOVS     r0,#1
00004c  f7fffffe          BL       RCC_PLLCmd
;;;863    
;;;864        /* Wait till PLL is ready */
;;;865        while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET)
000050  bf00              NOP      
                  |L3.82|
000052  2039              MOVS     r0,#0x39
000054  f7fffffe          BL       RCC_GetFlagStatus
000058  2800              CMP      r0,#0
00005a  d0fa              BEQ      |L3.82|
;;;866        {
;;;867        }
;;;868    
;;;869        /* Select PLL as system clock source */
;;;870        RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK);
00005c  2002              MOVS     r0,#2
00005e  f7fffffe          BL       RCC_SYSCLKConfig
;;;871    
;;;872        /* Wait till PLL is used as system clock source */
;;;873        while(RCC_GetSYSCLKSource() != 0x08)
000062  bf00              NOP      
                  |L3.100|
000064  f7fffffe          BL       RCC_GetSYSCLKSource
000068  2808              CMP      r0,#8
00006a  d1fb              BNE      |L3.100|
                  |L3.108|
;;;874        {
;;;875        }
;;;876      }
;;;877       
;;;878      /* Enable USART1 and GPIOA clock */
;;;879      RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1 | RCC_APB2Periph_GPIOA, ENABLE);
00006c  2101              MOVS     r1,#1
00006e  f2440004          MOV      r0,#0x4004
000072  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;880    }
000076  bd10              POP      {r4,pc}
;;;881    
                          ENDP

                  |L3.120|
                          DCD      HSEStartUpStatus

                          AREA ||i.USART_Configuration||, CODE, READONLY, ALIGN=2

                  USART_Configuration PROC
;;;929    *******************************************************************************/
;;;930    void USART_Configuration(void)
000000  b500              PUSH     {lr}
;;;931    {
000002  b087              SUB      sp,sp,#0x1c
;;;932      USART_InitTypeDef USART_InitStructure;
;;;933      USART_ClockInitTypeDef  USART_ClockInitStructure;
;;;934    /* USART1 configuration -----------------------------------------------
;;;935    
;;;936    -------*/
;;;937      /* USART1 configured as follow:
;;;938            - BaudRate = 115200 baud  
;;;939            - Word Length = 8 Bits
;;;940            - One Stop Bit
;;;941            - No parity
;;;942            - Hardware flow control disabled (RTS and CTS signals)
;;;943            - Receive and transmit enabled
;;;944            - USART Clock disabled
;;;945            - USART CPOL: Clock is active low
;;;946            - USART CPHA: Data is captured on the middle 
;;;947            - USART LastBit: The clock pulse of the last data bit is not 
;;;948    
;;;949    output to 
;;;950                             the SCLK pin
;;;951      */
;;;952    USART_ClockInitStructure.USART_Clock = USART_Clock_Disable;
000004  f04f0000          MOV      r0,#0
000008  f8ad0004          STRH     r0,[sp,#4]
;;;953    USART_ClockInitStructure.USART_CPOL = USART_CPOL_Low;
00000c  f8ad0006          STRH     r0,[sp,#6]
;;;954    USART_ClockInitStructure.USART_CPHA = USART_CPHA_2Edge;
000010  f44f7000          MOV      r0,#0x200
000014  f8ad0008          STRH     r0,[sp,#8]
;;;955    USART_ClockInitStructure.USART_LastBit = USART_LastBit_Disable;
000018  f04f0000          MOV      r0,#0
00001c  f8ad000a          STRH     r0,[sp,#0xa]
;;;956    /* Configure the USART1 synchronous paramters */
;;;957    USART_ClockInit(USART1, &USART_ClockInitStructure);
000020  a901              ADD      r1,sp,#4
000022  480f              LDR      r0,|L4.96|
000024  f7fffffe          BL       USART_ClockInit
;;;958    
;;;959    USART_InitStructure.USART_BaudRate = 115200;
000028  f44f30e1          MOV      r0,#0x1c200
00002c  9003              STR      r0,[sp,#0xc]
;;;960    USART_InitStructure.USART_WordLength = USART_WordLength_8b;
00002e  f04f0000          MOV      r0,#0
000032  f8ad0010          STRH     r0,[sp,#0x10]
;;;961    USART_InitStructure.USART_StopBits = USART_StopBits_1;
000036  f8ad0012          STRH     r0,[sp,#0x12]
;;;962    USART_InitStructure.USART_Parity = USART_Parity_No ;
00003a  f8ad0014          STRH     r0,[sp,#0x14]
;;;963    USART_InitStructure.USART_HardwareFlowControl = 
00003e  f8ad0018          STRH     r0,[sp,#0x18]
;;;964    
;;;965    USART_HardwareFlowControl_None;
;;;966    
;;;967    
;;;968    USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
000042  f04f000c          MOV      r0,#0xc
000046  f8ad0016          STRH     r0,[sp,#0x16]
;;;969    /* Configure USART1 basic and asynchronous paramters */
;;;970    USART_Init(USART1, &USART_InitStructure);
00004a  a903              ADD      r1,sp,#0xc
00004c  4804              LDR      r0,|L4.96|
00004e  f7fffffe          BL       USART_Init
;;;971        
;;;972      /* Enable USART1 */
;;;973      USART_Cmd(USART1, ENABLE);
000052  2101              MOVS     r1,#1
000054  4802              LDR      r0,|L4.96|
000056  f7fffffe          BL       USART_Cmd
;;;974    }
00005a  b007              ADD      sp,sp,#0x1c
00005c  bd00              POP      {pc}
;;;975    
                          ENDP

00005e  0000              DCW      0x0000
                  |L4.96|
                          DCD      0x40013800

                          AREA ||i.adjust_error_handling||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_s
                          REQUIRE _printf_str
                          REQUIRE _scanf_int
                  adjust_error_handling PROC
;;;494    
;;;495    int adjust_error_handling(
000000  b570              PUSH     {r4-r6,lr}
;;;496    int args,
;;;497    int * print_stack,
;;;498    int * do_next)
;;;499    {
000002  b096              SUB      sp,sp,#0x58
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4614              MOV      r4,r2
;;;500        char buffer[80];
;;;501        int choice;
;;;502    
;;;503        for(;;)
00000a  bf00              NOP      
                  |L5.12|
;;;504        {
;;;505            fprintf(stderr, "enter a number:\r\n");
00000c  a13b              ADR      r1,|L5.252|
00000e  4840              LDR      r0,|L5.272|
000010  f7fffffe          BL       __2fprintf
;;;506            fprintf(stderr, "1 = done with error handling\r\n");
000014  a13f              ADR      r1,|L5.276|
000016  483e              LDR      r0,|L5.272|
000018  f7fffffe          BL       __2fprintf
;;;507            fprintf(stderr, "2 = %sprint stack on error\r\n",
00001c  6830              LDR      r0,[r6,#0]
00001e  2801              CMP      r0,#1
000020  d101              BNE      |L5.38|
;;;508                ((*print_stack IS ON) ? "do not " : ""));
000022  a044              ADR      r0,|L5.308|
000024  e000              B        |L5.40|
                  |L5.38|
000026  a045              ADR      r0,|L5.316|
                  |L5.40|
000028  4602              MOV      r2,r0
00002a  a145              ADR      r1,|L5.320|
00002c  4838              LDR      r0,|L5.272|
00002e  f7fffffe          BL       __2fprintf
;;;509            if (args IS 3)
000032  2d03              CMP      r5,#3
000034  d10b              BNE      |L5.78|
;;;510            {
;;;511                if (*do_next IS 0)                    /* 0 means continue */
000036  6820              LDR      r0,[r4,#0]
000038  b920              CBNZ     r0,|L5.68|
;;;512                    fprintf(stderr,
00003a  a149              ADR      r1,|L5.352|
00003c  4834              LDR      r0,|L5.272|
00003e  f7fffffe          BL       __2fprintf
000042  e019              B        |L5.120|
                  |L5.68|
;;;513                        "3 = stop on error (do not continue)\r\n");
;;;514                else                                  /* if do_next IS 2 -- 2 means stopping on error */
;;;515                    fprintf(stderr,
000044  a150              ADR      r1,|L5.392|
000046  4832              LDR      r0,|L5.272|
000048  f7fffffe          BL       __2fprintf
00004c  e014              B        |L5.120|
                  |L5.78|
;;;516                        "3 = continue on error (do not stop)\r\n");
;;;517            }
;;;518            else if (args IS 2)
00004e  2d02              CMP      r5,#2
000050  d112              BNE      |L5.120|
;;;519            {
;;;520                if (*do_next IS 0)                    /* 0 means continue */
000052  6820              LDR      r0,[r4,#0]
000054  b920              CBNZ     r0,|L5.96|
;;;521                    fprintf(stderr,
000056  a156              ADR      r1,|L5.432|
000058  482d              LDR      r0,|L5.272|
00005a  f7fffffe          BL       __2fprintf
00005e  e00b              B        |L5.120|
                  |L5.96|
;;;522                        "3 = mdi on error (do not continue or stop)\r\n");
;;;523                else if (*do_next IS 1)               /* 1 means MDI */
000060  6820              LDR      r0,[r4,#0]
000062  2801              CMP      r0,#1
000064  d104              BNE      |L5.112|
;;;524                    fprintf(stderr,
000066  a15e              ADR      r1,|L5.480|
000068  4829              LDR      r0,|L5.272|
00006a  f7fffffe          BL       __2fprintf
00006e  e003              B        |L5.120|
                  |L5.112|
;;;525                            "3 = stop on error (do not mdi or continue)\r\n");
;;;526                else                                  /* if do_next IS 2 -- 2 means stopping on error */
;;;527                    fprintf(stderr,
000070  a167              ADR      r1,|L5.528|
000072  4827              LDR      r0,|L5.272|
000074  f7fffffe          BL       __2fprintf
                  |L5.120|
;;;528                        "3 = continue on error (do not stop or mdi)\r\n");
;;;529            }
;;;530            fprintf(stderr, "enter choice => ");
000078  a171              ADR      r1,|L5.576|
00007a  4825              LDR      r0,|L5.272|
00007c  f7fffffe          BL       __2fprintf
;;;531            gets(buffer);
000080  a802              ADD      r0,sp,#8
000082  f7fffffe          BL       gets
;;;532            if (sscanf(buffer, "%d", &choice) ISNT 1)
000086  aa01              ADD      r2,sp,#4
000088  a172              ADR      r1,|L5.596|
00008a  a802              ADD      r0,sp,#8
00008c  f7fffffe          BL       __0sscanf
000090  2801              CMP      r0,#1
000092  d000              BEQ      |L5.150|
;;;533                continue;
000094  e7ba              B        |L5.12|
                  |L5.150|
;;;534            if (choice IS 1)
000096  9801              LDR      r0,[sp,#4]
000098  2801              CMP      r0,#1
00009a  d100              BNE      |L5.158|
;;;535                break;
00009c  e029              B        |L5.242|
                  |L5.158|
;;;536            else if (choice IS 2)
00009e  9801              LDR      r0,[sp,#4]
0000a0  2802              CMP      r0,#2
0000a2  d108              BNE      |L5.182|
;;;537                *print_stack SET_TO ((*print_stack IS OFF) ? ON : OFF);
0000a4  6830              LDR      r0,[r6,#0]
0000a6  b910              CBNZ     r0,|L5.174|
0000a8  f04f0001          MOV      r0,#1
0000ac  e001              B        |L5.178|
                  |L5.174|
0000ae  f04f0000          MOV      r0,#0
                  |L5.178|
0000b2  6030              STR      r0,[r6,#0]
0000b4  e01c              B        |L5.240|
                  |L5.182|
;;;538            else if ((choice IS 3) AND (args IS 3))
0000b6  9801              LDR      r0,[sp,#4]
0000b8  2803              CMP      r0,#3
0000ba  d10a              BNE      |L5.210|
0000bc  2d03              CMP      r5,#3
0000be  d108              BNE      |L5.210|
;;;539                *do_next SET_TO ((*do_next IS 0) ? 2 : 0);
0000c0  6820              LDR      r0,[r4,#0]
0000c2  b910              CBNZ     r0,|L5.202|
0000c4  f04f0002          MOV      r0,#2
0000c8  e001              B        |L5.206|
                  |L5.202|
0000ca  f04f0000          MOV      r0,#0
                  |L5.206|
0000ce  6020              STR      r0,[r4,#0]
0000d0  e00e              B        |L5.240|
                  |L5.210|
;;;540            else if ((choice IS 3) AND (args IS 2))
0000d2  9801              LDR      r0,[sp,#4]
0000d4  2803              CMP      r0,#3
0000d6  d10b              BNE      |L5.240|
0000d8  2d02              CMP      r5,#2
0000da  d109              BNE      |L5.240|
;;;541                *do_next SET_TO ((*do_next IS 2) ? 0 : (*do_next + 1));
0000dc  6820              LDR      r0,[r4,#0]
0000de  2802              CMP      r0,#2
0000e0  d102              BNE      |L5.232|
0000e2  f04f0000          MOV      r0,#0
0000e6  e002              B        |L5.238|
                  |L5.232|
0000e8  6820              LDR      r0,[r4,#0]
0000ea  f1000001          ADD      r0,r0,#1
                  |L5.238|
0000ee  6020              STR      r0,[r4,#0]
                  |L5.240|
0000f0  e78c              B        |L5.12|
                  |L5.242|
0000f2  bf00              NOP                            ;535
;;;542        }
;;;543        return 0;
0000f4  2000              MOVS     r0,#0
;;;544    }
0000f6  b016              ADD      sp,sp,#0x58
0000f8  bd70              POP      {r4-r6,pc}
;;;545    
                          ENDP

0000fa  0000              DCW      0x0000
                  |L5.252|
0000fc  656e7465          DCB      "enter a number:\r\n",0
000100  72206120
000104  6e756d62
000108  65723a0d
00010c  0a00    
00010e  00                DCB      0
00010f  00                DCB      0
                  |L5.272|
                          DCD      __stderr
                  |L5.276|
000114  31203d20          DCB      "1 = done with error handling\r\n",0
000118  646f6e65
00011c  20776974
000120  68206572
000124  726f7220
000128  68616e64
00012c  6c696e67
000130  0d0a00  
000133  00                DCB      0
                  |L5.308|
000134  646f206e          DCB      "do not ",0
000138  6f742000
                  |L5.316|
00013c  00                DCB      0
00013d  00                DCB      0
00013e  00                DCB      0
00013f  00                DCB      0
                  |L5.320|
000140  32203d20          DCB      "2 = %sprint stack on error\r\n",0
000144  25737072
000148  696e7420
00014c  73746163
000150  6b206f6e
000154  20657272
000158  6f720d0a
00015c  00      
00015d  00                DCB      0
00015e  00                DCB      0
00015f  00                DCB      0
                  |L5.352|
000160  33203d20          DCB      "3 = stop on error (do not continue)\r\n",0
000164  73746f70
000168  206f6e20
00016c  6572726f
000170  72202864
000174  6f206e6f
000178  7420636f
00017c  6e74696e
000180  7565290d
000184  0a00    
000186  00                DCB      0
000187  00                DCB      0
                  |L5.392|
000188  33203d20          DCB      "3 = continue on error (do not stop)\r\n",0
00018c  636f6e74
000190  696e7565
000194  206f6e20
000198  6572726f
00019c  72202864
0001a0  6f206e6f
0001a4  74207374
0001a8  6f70290d
0001ac  0a00    
0001ae  00                DCB      0
0001af  00                DCB      0
                  |L5.432|
0001b0  33203d20          DCB      "3 = mdi on error (do not continue or stop)\r\n",0
0001b4  6d646920
0001b8  6f6e2065
0001bc  72726f72
0001c0  2028646f
0001c4  206e6f74
0001c8  20636f6e
0001cc  74696e75
0001d0  65206f72
0001d4  2073746f
0001d8  70290d0a
0001dc  00      
0001dd  00                DCB      0
0001de  00                DCB      0
0001df  00                DCB      0
                  |L5.480|
0001e0  33203d20          DCB      "3 = stop on error (do not mdi or continue)\r\n",0
0001e4  73746f70
0001e8  206f6e20
0001ec  6572726f
0001f0  72202864
0001f4  6f206e6f
0001f8  74206d64
0001fc  69206f72
000200  20636f6e
000204  74696e75
000208  65290d0a
00020c  00      
00020d  00                DCB      0
00020e  00                DCB      0
00020f  00                DCB      0
                  |L5.528|
000210  33203d20          DCB      "3 = continue on error (do not stop or mdi)\r\n",0
000214  636f6e74
000218  696e7565
00021c  206f6e20
000220  6572726f
000224  72202864
000228  6f206e6f
00022c  74207374
000230  6f70206f
000234  72206d64
000238  69290d0a
00023c  00      
00023d  00                DCB      0
00023e  00                DCB      0
00023f  00                DCB      0
                  |L5.576|
000240  656e7465          DCB      "enter choice => ",0
000244  72206368
000248  6f696365
00024c  203d3e20
000250  00      
000251  00                DCB      0
000252  00                DCB      0
000253  00                DCB      0
                  |L5.596|
000254  256400            DCB      "%d",0
000257  00                DCB      0

                          AREA ||i.designate_parameter_file||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_s
                          REQUIRE _printf_str
                  designate_parameter_file PROC
;;;442    
;;;443    int designate_parameter_file(char * file_name)
000000  b570              PUSH     {r4-r6,lr}
;;;444    {
000002  4604              MOV      r4,r0
;;;445        FILE * test_port;
;;;446    
;;;447        fprintf(stderr, "name of parameter file => ");
000004  a10c              ADR      r1,|L6.56|
000006  4813              LDR      r0,|L6.84|
000008  f7fffffe          BL       __2fprintf
;;;448        gets(file_name);
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       gets
;;;449        test_port SET_TO fopen(file_name, "r");
000012  a111              ADR      r1,|L6.88|
000014  4620              MOV      r0,r4
000016  f7fffffe          BL       fopen
00001a  4605              MOV      r5,r0
;;;450        if (test_port IS NULL)
00001c  b935              CBNZ     r5,|L6.44|
;;;451        {
;;;452            fprintf(stderr, "Cannot open %s\r\n", file_name);
00001e  4622              MOV      r2,r4
000020  a10e              ADR      r1,|L6.92|
000022  480c              LDR      r0,|L6.84|
000024  f7fffffe          BL       __2fprintf
;;;453            return 1;
000028  2001              MOVS     r0,#1
                  |L6.42|
;;;454        }
;;;455        fclose(test_port);
;;;456        return 0;
;;;457    }
00002a  bd70              POP      {r4-r6,pc}
                  |L6.44|
00002c  4628              MOV      r0,r5                 ;455
00002e  f7fffffe          BL       fclose
000032  2000              MOVS     r0,#0                 ;456
000034  e7f9              B        |L6.42|
;;;458    
                          ENDP

000036  0000              DCW      0x0000
                  |L6.56|
000038  6e616d65          DCB      "name of parameter file => ",0
00003c  206f6620
000040  70617261
000044  6d657465
000048  72206669
00004c  6c65203d
000050  3e2000  
000053  00                DCB      0
                  |L6.84|
                          DCD      __stderr
                  |L6.88|
000058  7200              DCB      "r",0
00005a  00                DCB      0
00005b  00                DCB      0
                  |L6.92|
00005c  43616e6e          DCB      "Cannot open %s\r\n",0
000060  6f74206f
000064  70656e20
000068  25730d0a
00006c  00      
00006d  00                DCB      0
00006e  00                DCB      0
00006f  00                DCB      0

                          AREA ||i.fputc||, CODE, READONLY, ALIGN=2

                  fputc PROC
;;;982    *******************************************************************************/
;;;983    int fputc(int ch, FILE *f)
000000  b570              PUSH     {r4-r6,lr}
;;;984    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;985      /* Place your implementation of fputc here */
;;;986      /* e.g. write a character to the USART */
;;;987      USART_SendData(USART1, (u8) ch);
000006  b2e1              UXTB     r1,r4
000008  4805              LDR      r0,|L7.32|
00000a  f7fffffe          BL       USART_SendData
;;;988    
;;;989      /* Loop until the end of transmission */
;;;990      while(USART_GetFlagStatus(USART1, USART_FLAG_TC) == RESET)
00000e  bf00              NOP      
                  |L7.16|
000010  2140              MOVS     r1,#0x40
000012  4803              LDR      r0,|L7.32|
000014  f7fffffe          BL       USART_GetFlagStatus
000018  2800              CMP      r0,#0
00001a  d0f9              BEQ      |L7.16|
;;;991      {
;;;992      }
;;;993    
;;;994      return ch;
00001c  4620              MOV      r0,r4
;;;995    }
00001e  bd70              POP      {r4-r6,pc}
;;;996    
                          ENDP

                  |L7.32|
                          DCD      0x40013800

                          AREA ||i.interpret_from_file||, CODE, READONLY, ALIGN=2

                  interpret_from_file PROC
;;;248    
;;;249    int interpret_from_file(                          /* ARGUMENTS                  */
000000  b5f0              PUSH     {r4-r7,lr}
;;;250    int do_next,                                      /* what to do if error        */
;;;251    int block_delete,                                 /* switch which is ON or OFF  */
;;;252    int print_stack)                                  /* option which is ON or OFF  */
;;;253    {
000002  b0c1              SUB      sp,sp,#0x104
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4617              MOV      r7,r2
;;;254        int status;
;;;255        char line[RS274NGC_TEXT_SIZE];
;;;256    
;;;257        for(; ;)
00000a  bf00              NOP      
                  |L8.12|
;;;258        {
;;;259            status SET_TO rs274ngc_read(NULL);
00000c  2000              MOVS     r0,#0
00000e  f7fffffe          BL       rs274ngc_read
000012  4604              MOV      r4,r0
;;;260            if ((status IS RS274NGC_EXECUTE_FINISH) AND (block_delete IS ON))
000014  2c02              CMP      r4,#2
000016  d102              BNE      |L8.30|
000018  2e01              CMP      r6,#1
00001a  d100              BNE      |L8.30|
;;;261                continue;
00001c  e7f6              B        |L8.12|
                  |L8.30|
;;;262            else if (status IS RS274NGC_ENDFILE)
00001e  2c03              CMP      r4,#3
000020  d100              BNE      |L8.36|
;;;263                break;
000022  e055              B        |L8.208|
                  |L8.36|
;;;264            if ((status ISNT RS274NGC_OK) AND         // should not be EXIT
000024  2c00              CMP      r4,#0
000026  d027              BEQ      |L8.120|
;;;265                (status ISNT RS274NGC_EXECUTE_FINISH))
000028  2c02              CMP      r4,#2
00002a  d025              BEQ      |L8.120|
;;;266            {
;;;267                report_error(status, print_stack);
00002c  4639              MOV      r1,r7
00002e  4620              MOV      r0,r4
000030  f7fffffe          BL       report_error
;;;268                if ((status IS NCE_FILE_ENDED_WITH_NO_PERCENT_SIGN) OR
000034  2c50              CMP      r4,#0x50
000036  d001              BEQ      |L8.60|
;;;269                    (do_next IS 2))                   /* 2 means stop */
000038  2d02              CMP      r5,#2
00003a  d103              BNE      |L8.68|
                  |L8.60|
;;;270                {
;;;271                    status SET_TO 1;
00003c  f04f0001          MOV      r0,#1
000040  4604              MOV      r4,r0
;;;272                    break;
000042  e045              B        |L8.208|
                  |L8.68|
;;;273                }
;;;274                else if (do_next IS 1)                /* 1 means MDI */
000044  2d01              CMP      r5,#1
000046  d116              BNE      |L8.118|
;;;275                {
;;;276                    fprintf(stderr, "starting MDI\r\n");
000048  a125              ADR      r1,|L8.224|
00004a  4829              LDR      r0,|L8.240|
00004c  f7fffffe          BL       __2fprintf
;;;277                    interpret_from_keyboard(block_delete, print_stack);
000050  4639              MOV      r1,r7
000052  4630              MOV      r0,r6
000054  f7fffffe          BL       interpret_from_keyboard
;;;278                    fprintf(stderr, "continue program? y/n =>");
000058  a126              ADR      r1,|L8.244|
00005a  4825              LDR      r0,|L8.240|
00005c  f7fffffe          BL       __2fprintf
;;;279                    gets(line);
000060  a801              ADD      r0,sp,#4
000062  f7fffffe          BL       gets
;;;280                    if (line[0] ISNT 'y')
000066  f89d0004          LDRB     r0,[sp,#4]
00006a  2879              CMP      r0,#0x79
00006c  d002              BEQ      |L8.116|
;;;281                    {
;;;282                        status SET_TO 1;
00006e  4628              MOV      r0,r5
000070  4604              MOV      r4,r0
;;;283                        break;
000072  e02d              B        |L8.208|
                  |L8.116|
;;;284                    }
;;;285                    else
;;;286                        continue;
000074  e7ca              B        |L8.12|
                  |L8.118|
;;;287                }
;;;288                else                                  /* if do_next IS 0 -- 0 means continue */
;;;289                    continue;
000076  e7c9              B        |L8.12|
                  |L8.120|
;;;290            }
;;;291            status SET_TO rs274ngc_execute();
000078  f7fffffe          BL       rs274ngc_execute
00007c  4604              MOV      r4,r0
;;;292            if ((status ISNT RS274NGC_OK) AND
00007e  b31c              CBZ      r4,|L8.200|
;;;293                (status ISNT RS274NGC_EXIT) AND
000080  2c01              CMP      r4,#1
000082  d021              BEQ      |L8.200|
;;;294                (status ISNT RS274NGC_EXECUTE_FINISH))
000084  2c02              CMP      r4,#2
000086  d01f              BEQ      |L8.200|
;;;295            {
;;;296                report_error(status, print_stack);
000088  4639              MOV      r1,r7
00008a  4620              MOV      r0,r4
00008c  f7fffffe          BL       report_error
;;;297                status SET_TO 1;
000090  f04f0001          MOV      r0,#1
000094  4604              MOV      r4,r0
;;;298                if (do_next IS 1)                     /* 1 means MDI */
000096  2d01              CMP      r5,#1
000098  d113              BNE      |L8.194|
;;;299                {
;;;300                    fprintf(stderr, "starting MDI\r\n");
00009a  a111              ADR      r1,|L8.224|
00009c  4814              LDR      r0,|L8.240|
00009e  f7fffffe          BL       __2fprintf
;;;301                    interpret_from_keyboard(block_delete, print_stack);
0000a2  4639              MOV      r1,r7
0000a4  4630              MOV      r0,r6
0000a6  f7fffffe          BL       interpret_from_keyboard
;;;302                    fprintf(stderr, "continue program? y/n =>");
0000aa  a112              ADR      r1,|L8.244|
0000ac  4810              LDR      r0,|L8.240|
0000ae  f7fffffe          BL       __2fprintf
;;;303                    gets(line);
0000b2  a801              ADD      r0,sp,#4
0000b4  f7fffffe          BL       gets
;;;304                    if (line[0] ISNT 'y')
0000b8  f89d0004          LDRB     r0,[sp,#4]
0000bc  2879              CMP      r0,#0x79
0000be  d006              BEQ      |L8.206|
;;;305                        break;
0000c0  e006              B        |L8.208|
                  |L8.194|
;;;306                }
;;;307                else if (do_next IS 2)                /* 2 means stop */
0000c2  2d02              CMP      r5,#2
0000c4  d103              BNE      |L8.206|
;;;308                    break;
0000c6  e003              B        |L8.208|
                  |L8.200|
;;;309            }
;;;310            else if (status IS RS274NGC_EXIT)
0000c8  2c01              CMP      r4,#1
0000ca  d100              BNE      |L8.206|
;;;311                break;
0000cc  e000              B        |L8.208|
                  |L8.206|
0000ce  e79d              B        |L8.12|
                  |L8.208|
0000d0  bf00              NOP                            ;263
;;;312        }
;;;313        return ((status IS 1) ? 1 : 0);
0000d2  2c01              CMP      r4,#1
0000d4  d102              BNE      |L8.220|
0000d6  2001              MOVS     r0,#1
                  |L8.216|
;;;314    }
0000d8  b041              ADD      sp,sp,#0x104
0000da  bdf0              POP      {r4-r7,pc}
                  |L8.220|
0000dc  2000              MOVS     r0,#0                 ;313
0000de  e7fb              B        |L8.216|
;;;315    
                          ENDP

                  |L8.224|
0000e0  73746172          DCB      "starting MDI\r\n",0
0000e4  74696e67
0000e8  204d4449
0000ec  0d0a00  
0000ef  00                DCB      0
                  |L8.240|
                          DCD      __stderr
                  |L8.244|
0000f4  636f6e74          DCB      "continue program? y/n =>",0
0000f8  696e7565
0000fc  2070726f
000100  6772616d
000104  3f20792f
000108  6e203d3e
00010c  00      
00010d  00                DCB      0
00010e  00                DCB      0
00010f  00                DCB      0

                          AREA ||i.interpret_from_keyboard||, CODE, READONLY, ALIGN=2

                  interpret_from_keyboard PROC
;;;154    
;;;155    int interpret_from_keyboard(                      /* ARGUMENTS                 */
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;156    int block_delete,                                 /* switch which is ON or OFF */
;;;157    int print_stack)                                  /* option which is ON or OFF */
;;;158    {
000004  b0c0              SUB      sp,sp,#0x100
000006  4607              MOV      r7,r0
000008  4688              MOV      r8,r1
;;;159        char line[RS274NGC_TEXT_SIZE];
;;;160        int status;
;;;161    	char temp;
;;;162    	u16 count=0;
00000a  f04f0000          MOV      r0,#0
00000e  4606              MOV      r6,r0
;;;163    
;;;164        for(; ;)
000010  bf00              NOP      
                  |L9.18|
;;;165        {
;;;166    		while(1)
000012  e02b              B        |L9.108|
                  |L9.20|
;;;167    		{	
;;;168    			temp =  _nc_code_buffer[gNowCount];
000014  482b              LDR      r0,|L9.196|
000016  492c              LDR      r1,|L9.200|
000018  6809              LDR      r1,[r1,#0]  ; gNowCount
00001a  5c45              LDRB     r5,[r0,r1]
;;;169    			gNowCount = gNowCount + 1;
00001c  482a              LDR      r0,|L9.200|
00001e  6800              LDR      r0,[r0,#0]  ; gNowCount
000020  f1000001          ADD      r0,r0,#1
000024  4928              LDR      r1,|L9.200|
000026  6008              STR      r0,[r1,#0]  ; gNowCount
;;;170    			if(gNowCount<strlen(_nc_code_buffer))
000028  4826              LDR      r0,|L9.196|
00002a  f7fffffe          BL       strlen
00002e  4926              LDR      r1,|L9.200|
000030  6809              LDR      r1,[r1,#0]  ; gNowCount
000032  4288              CMP      r0,r1
000034  d91a              BLS      |L9.108|
;;;171    			{
;;;172    				if(temp=='%')
000036  2d25              CMP      r5,#0x25
000038  d100              BNE      |L9.60|
;;;173    				{
;;;174    					//整段结束
;;;175    					break;
00003a  e018              B        |L9.110|
                  |L9.60|
;;;176    				}
;;;177    				else
;;;178    				{
;;;179    					if(temp==';')
00003c  2d3b              CMP      r5,#0x3b
00003e  d10e              BNE      |L9.94|
;;;180    					{
;;;181    						for(;count<RS274NGC_TEXT_SIZE;count++)			
000040  e007              B        |L9.82|
                  |L9.66|
;;;182    						{
;;;183    							line[count]='\0';	/*将数组line中count与RS274NGC_TEXT_SIZE之间的空间填充为‘\0’*/
000042  f04f0000          MOV      r0,#0
000046  f80d0006          STRB     r0,[sp,r6]
00004a  f1060001          ADD      r0,r6,#1              ;181
00004e  b280              UXTH     r0,r0                 ;181
000050  4606              MOV      r6,r0                 ;181
                  |L9.82|
000052  2eff              CMP      r6,#0xff              ;181
000054  ddf5              BLE      |L9.66|
;;;184    						}
;;;185    						count=0;
000056  f04f0000          MOV      r0,#0
00005a  4606              MOV      r6,r0
;;;186    						break;
00005c  e007              B        |L9.110|
                  |L9.94|
;;;187    					}
;;;188    					else
;;;189    					{
;;;190    						line[count++]=temp;
00005e  4630              MOV      r0,r6
000060  f1060101          ADD      r1,r6,#1
000064  b289              UXTH     r1,r1
000066  460e              MOV      r6,r1
000068  f80d5000          STRB     r5,[sp,r0]
                  |L9.108|
00006c  e7d2              B        |L9.20|
                  |L9.110|
00006e  bf00              NOP                            ;175
;;;191    					}
;;;192    				}
;;;193    			}
;;;194    		}
;;;195            if (strcmp (line, "quit") IS 0)
000070  a116              ADR      r1,|L9.204|
000072  4668              MOV      r0,sp
000074  f7fffffe          BL       strcmp
000078  b918              CBNZ     r0,|L9.130|
;;;196                return 0;
00007a  2000              MOVS     r0,#0
;;;197            status SET_TO rs274ngc_read(line);
;;;198    		
;;;199            if ((status IS RS274NGC_EXECUTE_FINISH) AND (block_delete IS ON));
;;;200            else if (status IS RS274NGC_ENDFILE);
;;;201            else if ((status ISNT RS274NGC_EXECUTE_FINISH) AND
;;;202                (status ISNT RS274NGC_OK))
;;;203                report_error(status, print_stack);
;;;204            else
;;;205            {
;;;206                status SET_TO rs274ngc_execute();    
;;;207                if ((status IS RS274NGC_EXIT) OR
;;;208                    (status IS RS274NGC_EXECUTE_FINISH));
;;;209                else if (status ISNT RS274NGC_OK)
;;;210                    report_error(status, print_stack);
;;;211            }
;;;212        }
;;;213    }
00007c  b040              ADD      sp,sp,#0x100
00007e  e8bd81f0          POP      {r4-r8,pc}
                  |L9.130|
000082  4668              MOV      r0,sp                 ;197
000084  f7fffffe          BL       rs274ngc_read
000088  4604              MOV      r4,r0                 ;197
00008a  2c02              CMP      r4,#2                 ;199
00008c  d101              BNE      |L9.146|
00008e  2f01              CMP      r7,#1                 ;199
000090  d0bf              BEQ      |L9.18|
                  |L9.146|
000092  2c03              CMP      r4,#3                 ;200
000094  d0bd              BEQ      |L9.18|
000096  2c02              CMP      r4,#2                 ;201
000098  d005              BEQ      |L9.166|
00009a  b124              CBZ      r4,|L9.166|
00009c  4641              MOV      r1,r8                 ;203
00009e  4620              MOV      r0,r4                 ;203
0000a0  f7fffffe          BL       report_error
0000a4  e7b5              B        |L9.18|
                  |L9.166|
0000a6  f7fffffe          BL       rs274ngc_execute
0000aa  4604              MOV      r4,r0                 ;206
0000ac  2c01              CMP      r4,#1                 ;207
0000ae  d0b0              BEQ      |L9.18|
0000b0  2c02              CMP      r4,#2                 ;208
0000b2  d0ae              BEQ      |L9.18|
0000b4  2c00              CMP      r4,#0                 ;209
0000b6  d0ac              BEQ      |L9.18|
0000b8  4641              MOV      r1,r8                 ;210
0000ba  4620              MOV      r0,r4                 ;210
0000bc  f7fffffe          BL       report_error
0000c0  e7a7              B        |L9.18|
;;;214    
                          ENDP

0000c2  0000              DCW      0x0000
                  |L9.196|
                          DCD      _nc_code_buffer
                  |L9.200|
                          DCD      gNowCount
                  |L9.204|
0000cc  71756974          DCB      "quit",0
0000d0  00      
0000d1  00                DCB      0
0000d2  00                DCB      0
0000d3  00                DCB      0

                          AREA ||i.main||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_s
                          REQUIRE _printf_str
                          REQUIRE _printf_str
                  main PROC
;;;644    
;;;645    int main(int argc, char ** argv)
000000  e92d43f0          PUSH     {r4-r9,lr}
;;;646    {  
000004  b0a1              SUB      sp,sp,#0x84
000006  4607              MOV      r7,r0
000008  460d              MOV      r5,r1
;;;647    /******************************RS274NGC之变量声明部分开始******************************/
;;;648    	int status;
;;;649    	int choice;
;;;650    	int do_next;                                  /* 0=continue, 1=mdi, 2=stop */
;;;651    	int block_delete;
;;;652    	int tool_flag;
;;;653    	int gees[RS274NGC_ACTIVE_G_CODES];
;;;654    	int ems[RS274NGC_ACTIVE_M_CODES];
;;;655    	double sets[RS274NGC_ACTIVE_SETTINGS];
;;;656    	char default_name[] SET_TO "rs274ngc.var";
00000a  a357              ADR      r3,|L10.360|
00000c  cb0f              LDM      r3,{r0-r3}
00000e  ac02              ADD      r4,sp,#8
000010  c40f              STM      r4!,{r0-r3}
;;;657    	int print_stack;
;;;658    /******************************RS274NGC之变量声明部分结束******************************/	
;;;659    	
;;;660    	
;;;661       
;;;662       
;;;663    #ifdef DEBUG
;;;664      debug();
;;;665    #endif
;;;666    
;;;667    	/* Configure the system clocks */
;;;668    	RCC_Configuration();
000012  f7fffffe          BL       RCC_Configuration
;;;669    	
;;;670    	/* NVIC Configuration */
;;;671    	NVIC_Configuration();
000016  f7fffffe          BL       NVIC_Configuration
;;;672    	
;;;673    	/* Configure the GPIOs */
;;;674    	GPIO_Configuration();
00001a  f7fffffe          BL       GPIO_Configuration
;;;675    	
;;;676    	/* Configure the USART1 */
;;;677    	USART_Configuration();
00001e  f7fffffe          BL       USART_Configuration
;;;678    	
;;;679    	
;;;680    	//printf("\r\n Welcome to www.PowerAVR.com \r\n");
;;;681    	//printf("\r\n Please Input Character From Keyboard \r\n");
;;;682    
;;;683        
;;;684    /******************************RS274/NGC源码的main函数开始******************************/
;;;685      	/*
;;;686    	if (argc > 3)
;;;687    	{
;;;688    	    fprintf(stderr, "Usage \"%s\"\r\n", argv[0]);
;;;689    	    fprintf(stderr, "   or \"%s <input file>\"\r\n", argv[0]);
;;;690    	    fprintf(stderr, "   or \"%s <input file> <output file>\"\r\n", argv[0])
;;;691    	    //exit(1);
;;;692    		return 1;
;;;693    	}
;;;694    	*/
;;;695    	choice=1;
000022  f04f0001          MOV      r0,#1
000026  4604              MOV      r4,r0
;;;696    
;;;697    	do_next SET_TO 2;                             /* 2=stop */
000028  f04f0002          MOV      r0,#2
00002c  901f              STR      r0,[sp,#0x7c]
;;;698    	block_delete SET_TO OFF;
00002e  f04f0000          MOV      r0,#0
000032  4606              MOV      r6,r0
;;;699    	print_stack SET_TO OFF;
000034  9001              STR      r0,[sp,#4]
;;;700    	tool_flag SET_TO 0;
000036  4680              MOV      r8,r0
;;;701    	strcpy(_parameter_file_name, default_name);
000038  a902              ADD      r1,sp,#8
00003a  484f              LDR      r0,|L10.376|
00003c  f7fffffe          BL       strcpy
;;;702    	_outfile SET_TO stdout;                       /* may be reset below */
000040  484e              LDR      r0,|L10.380|
000042  494f              LDR      r1,|L10.384|
000044  6008              STR      r0,[r1,#0]  ; _outfile
;;;703    	
;;;704    	for(; ;)
000046  bf00              NOP      
                  |L10.72|
;;;705    	{
;;;706    	    fprintf(stderr, "\r\nenter a number:\r\n");
000048  a14e              ADR      r1,|L10.388|
00004a  4853              LDR      r0,|L10.408|
00004c  f7fffffe          BL       __2fprintf
;;;707    	    fprintf(stderr, "1 = start interpreting\r\n");
000050  a152              ADR      r1,|L10.412|
000052  4851              LDR      r0,|L10.408|
000054  f7fffffe          BL       __2fprintf
;;;708    	    fprintf(stderr, "2 = choose parameter file ...\r\n");
000058  a157              ADR      r1,|L10.440|
00005a  484f              LDR      r0,|L10.408|
00005c  f7fffffe          BL       __2fprintf
;;;709    	    fprintf(stderr, "3 = read tool file ...\r\n");
000060  a15d              ADR      r1,|L10.472|
000062  484d              LDR      r0,|L10.408|
000064  f7fffffe          BL       __2fprintf
;;;710    	    fprintf(stderr, "4 = turn block delete switch %s\r\n",
000068  b90e              CBNZ     r6,|L10.110|
;;;711    	        ((block_delete IS OFF) ? "ON" : "OFF"));
00006a  a062              ADR      r0,|L10.500|
00006c  e000              B        |L10.112|
                  |L10.110|
00006e  a062              ADR      r0,|L10.504|
                  |L10.112|
000070  4602              MOV      r2,r0
000072  a162              ADR      r1,|L10.508|
000074  4848              LDR      r0,|L10.408|
000076  f7fffffe          BL       __2fprintf
;;;712    	    fprintf(stderr, "5 = adjust error handling...\r\n");
00007a  a169              ADR      r1,|L10.544|
00007c  4846              LDR      r0,|L10.408|
00007e  f7fffffe          BL       __2fprintf
;;;713    	    fprintf(stderr, "enter choice => 1\r\n");
000082  a16f              ADR      r1,|L10.576|
000084  4844              LDR      r0,|L10.408|
000086  f7fffffe          BL       __2fprintf
;;;714    	    //gets(buffer);
;;;715    	    //if (sscanf(buffer, "%d", &choice) ISNT 1)
;;;716    	    //    continue;
;;;717    	    if (choice IS 1)
00008a  2c01              CMP      r4,#1
00008c  d100              BNE      |L10.144|
;;;718    	        break;
00008e  e028              B        |L10.226|
                  |L10.144|
;;;719    	    else if (choice IS 2)
000090  2c02              CMP      r4,#2
000092  d108              BNE      |L10.166|
;;;720    	    {
;;;721    	        if (designate_parameter_file(_parameter_file_name) ISNT 0)
000094  4838              LDR      r0,|L10.376|
000096  f7fffffe          BL       designate_parameter_file
00009a  2800              CMP      r0,#0
00009c  d0d4              BEQ      |L10.72|
;;;722    				return 1;
00009e  2001              MOVS     r0,#1
                  |L10.160|
;;;723    /*	            exit(1);*/
;;;724    	    }
;;;725    	    else if (choice IS 3)
;;;726    	    {
;;;727    	        if (read_tool_file("") ISNT 0)
;;;728    				return 1;
;;;729    /*	            exit(1);*/
;;;730    	        tool_flag SET_TO 1;
;;;731    	    }
;;;732    	    else if (choice IS 4)
;;;733    	        block_delete SET_TO ((block_delete IS OFF) ? ON : OFF);
;;;734    	    else if (choice IS 5)
;;;735    	        adjust_error_handling(argc, &print_stack, &do_next);
;;;736    	}
;;;737    	fprintf(stderr, "executing\r\n");
;;;738    	if (tool_flag IS 0)
;;;739    	{
;;;740    	    if (read_tool_file("rs274ngc.tool_default") ISNT 0)
;;;741    			return 1;
;;;742    /*	        exit(1);*/
;;;743    	}
;;;744    	
;;;745    	if (argc IS 3)
;;;746    	{
;;;747    	    _outfile SET_TO fopen(argv[2], "w");
;;;748    	    if (_outfile IS NULL)
;;;749    	    {
;;;750    	        fprintf(stderr, "could not open output file %s\r\n", argv[2]);
;;;751    			return 1;
;;;752    /*	        exit(1);*/
;;;753    	    }
;;;754    	}
;;;755    	
;;;756    	if ((status SET_TO rs274ngc_init()) ISNT RS274NGC_OK)
;;;757    	{
;;;758    	    report_error(status, print_stack);
;;;759    		return 1;
;;;760    /*	    exit(1);*/
;;;761    	}
;;;762    	
;;;763    //	if (argc IS 1)
;;;764    	    status SET_TO interpret_from_keyboard(block_delete, print_stack);
;;;765    //	else                                          /* if (argc IS 2 or argc IS 3) */
;;;766    //	{
;;;767    //	    status SET_TO rs274ngc_open(argv[1]);
;;;768    //	    if (status ISNT RS274NGC_OK)              /* do not need to close since not open */
;;;769    //	    {
;;;770    //	        report_error(status, print_stack);
;;;771    //			return 1;
;;;772    ///*	        exit(1);*/
;;;773    //	    }
;;;774    //	    status SET_TO interpret_from_file(do_next, block_delete, print_stack);
;;;775    //	    rs274ngc_file_name(buffer, 5);            /* called to exercise the function */
;;;776    //	    rs274ngc_file_name(buffer, 79);           /* called to exercise the function */
;;;777    //	    rs274ngc_close();
;;;778    //	}
;;;779    	rs274ngc_line_length();                       /* called to exercise the function */
;;;780    	rs274ngc_sequence_number();                   /* called to exercise the function */
;;;781    	rs274ngc_active_g_codes(gees);                /* called to exercise the function */
;;;782    	rs274ngc_active_m_codes(ems);                 /* called to exercise the function */
;;;783    	rs274ngc_active_settings(sets);               /* called to exercise the function */
;;;784    	rs274ngc_exit();                              /* saves parameters */
;;;785    	return(status);
;;;786    /*	exit(status);*/
;;;787    /******************************RS274/NGC源码的main函数结束******************************/
;;;788    /*	while(1)
;;;789    	{	
;;;790    		if(USART_GetFlagStatus(USART1,USART_IT_RXNE)==SET)
;;;791    		{	           
;;;792    			i = USART_ReceiveData(USART1);
;;;793    			printf("  %c",i&0xFF);
;;;794    					
;;;795    		}
;;;796    	}*/
;;;797    }
0000a0  b021              ADD      sp,sp,#0x84
0000a2  e8bd83f0          POP      {r4-r9,pc}
                  |L10.166|
0000a6  2c03              CMP      r4,#3                 ;725
0000a8  d109              BNE      |L10.190|
0000aa  a032              ADR      r0,|L10.372|
0000ac  f7fffffe          BL       read_tool_file
0000b0  b108              CBZ      r0,|L10.182|
0000b2  2001              MOVS     r0,#1                 ;728
0000b4  e7f4              B        |L10.160|
                  |L10.182|
0000b6  f04f0001          MOV      r0,#1                 ;730
0000ba  4680              MOV      r8,r0                 ;730
0000bc  e7c4              B        |L10.72|
                  |L10.190|
0000be  2c04              CMP      r4,#4                 ;732
0000c0  d107              BNE      |L10.210|
0000c2  b916              CBNZ     r6,|L10.202|
0000c4  f04f0001          MOV      r0,#1                 ;733
0000c8  e001              B        |L10.206|
                  |L10.202|
0000ca  f04f0000          MOV      r0,#0                 ;733
                  |L10.206|
0000ce  4606              MOV      r6,r0                 ;733
0000d0  e7ba              B        |L10.72|
                  |L10.210|
0000d2  2c05              CMP      r4,#5                 ;734
0000d4  d1b8              BNE      |L10.72|
0000d6  aa1f              ADD      r2,sp,#0x7c           ;735
0000d8  a901              ADD      r1,sp,#4              ;735
0000da  4638              MOV      r0,r7                 ;735
0000dc  f7fffffe          BL       adjust_error_handling
0000e0  e7b2              B        |L10.72|
                  |L10.226|
0000e2  bf00              NOP                            ;718
0000e4  a15b              ADR      r1,|L10.596|
0000e6  482c              LDR      r0,|L10.408|
0000e8  f7fffffe          BL       __2fprintf
0000ec  f1b80f00          CMP      r8,#0                 ;738
0000f0  d105              BNE      |L10.254|
0000f2  a05b              ADR      r0,|L10.608|
0000f4  f7fffffe          BL       read_tool_file
0000f8  b108              CBZ      r0,|L10.254|
0000fa  2001              MOVS     r0,#1                 ;741
0000fc  e7d0              B        |L10.160|
                  |L10.254|
0000fe  2f03              CMP      r7,#3                 ;745
000100  d111              BNE      |L10.294|
000102  68a9              LDR      r1,[r5,#8]            ;747
000104  4608              MOV      r0,r1                 ;747
000106  a15c              ADR      r1,|L10.632|
000108  f7fffffe          BL       fopen
00010c  491c              LDR      r1,|L10.384|
00010e  6008              STR      r0,[r1,#0]            ;747  ; _outfile
000110  4608              MOV      r0,r1                 ;748
000112  6800              LDR      r0,[r0,#0]            ;748  ; _outfile
000114  b938              CBNZ     r0,|L10.294|
000116  68a8              LDR      r0,[r5,#8]            ;750
000118  4602              MOV      r2,r0                 ;750
00011a  a158              ADR      r1,|L10.636|
00011c  481e              LDR      r0,|L10.408|
00011e  f7fffffe          BL       __2fprintf
000122  2001              MOVS     r0,#1                 ;751
000124  e7bc              B        |L10.160|
                  |L10.294|
000126  f7fffffe          BL       rs274ngc_init
00012a  ea5f0900          MOVS     r9,r0                 ;756
00012e  d005              BEQ      |L10.316|
000130  4648              MOV      r0,r9                 ;758
000132  9901              LDR      r1,[sp,#4]            ;758
000134  f7fffffe          BL       report_error
000138  2001              MOVS     r0,#1                 ;759
00013a  e7b1              B        |L10.160|
                  |L10.316|
00013c  4630              MOV      r0,r6                 ;764
00013e  9901              LDR      r1,[sp,#4]            ;764
000140  f7fffffe          BL       interpret_from_keyboard
000144  4681              MOV      r9,r0                 ;764
000146  f7fffffe          BL       rs274ngc_line_length
00014a  f7fffffe          BL       rs274ngc_sequence_number
00014e  a813              ADD      r0,sp,#0x4c           ;781
000150  f7fffffe          BL       rs274ngc_active_g_codes
000154  a80c              ADD      r0,sp,#0x30           ;782
000156  f7fffffe          BL       rs274ngc_active_m_codes
00015a  a806              ADD      r0,sp,#0x18           ;783
00015c  f7fffffe          BL       rs274ngc_active_settings
000160  f7fffffe          BL       rs274ngc_exit
000164  4648              MOV      r0,r9                 ;785
000166  e79b              B        |L10.160|
;;;798    
                          ENDP

                  |L10.360|
000168  72733237          DCB      "rs274ngc.var"
00016c  346e6763
000170  2e766172
                  |L10.372|
000174  00                DCB      0
000175  00                DCB      0
000176  00                DCB      0
000177  00                DCB      0
                  |L10.376|
                          DCD      _parameter_file_name
                  |L10.380|
                          DCD      __stdout
                  |L10.384|
                          DCD      _outfile
                  |L10.388|
000184  0d0a656e          DCB      "\r\nenter a number:\r\n",0
000188  74657220
00018c  61206e75
000190  6d626572
000194  3a0d0a00
                  |L10.408|
                          DCD      __stderr
                  |L10.412|
00019c  31203d20          DCB      "1 = start interpreting\r\n",0
0001a0  73746172
0001a4  7420696e
0001a8  74657270
0001ac  72657469
0001b0  6e670d0a
0001b4  00      
0001b5  00                DCB      0
0001b6  00                DCB      0
0001b7  00                DCB      0
                  |L10.440|
0001b8  32203d20          DCB      "2 = choose parameter file ...\r\n",0
0001bc  63686f6f
0001c0  73652070
0001c4  6172616d
0001c8  65746572
0001cc  2066696c
0001d0  65202e2e
0001d4  2e0d0a00
                  |L10.472|
0001d8  33203d20          DCB      "3 = read tool file ...\r\n",0
0001dc  72656164
0001e0  20746f6f
0001e4  6c206669
0001e8  6c65202e
0001ec  2e2e0d0a
0001f0  00      
0001f1  00                DCB      0
0001f2  00                DCB      0
0001f3  00                DCB      0
                  |L10.500|
0001f4  4f4e00            DCB      "ON",0
0001f7  00                DCB      0
                  |L10.504|
0001f8  4f464600          DCB      "OFF",0
                  |L10.508|
0001fc  34203d20          DCB      "4 = turn block delete switch %s\r\n",0
000200  7475726e
000204  20626c6f
000208  636b2064
00020c  656c6574
000210  65207377
000214  69746368
000218  2025730d
00021c  0a00    
00021e  00                DCB      0
00021f  00                DCB      0
                  |L10.544|
000220  35203d20          DCB      "5 = adjust error handling...\r\n",0
000224  61646a75
000228  73742065
00022c  72726f72
000230  2068616e
000234  646c696e
000238  672e2e2e
00023c  0d0a00  
00023f  00                DCB      0
                  |L10.576|
000240  656e7465          DCB      "enter choice => 1\r\n",0
000244  72206368
000248  6f696365
00024c  203d3e20
000250  310d0a00
                  |L10.596|
000254  65786563          DCB      "executing\r\n",0
000258  7574696e
00025c  670d0a00
                  |L10.608|
000260  72733237          DCB      "rs274ngc.tool_default",0
000264  346e6763
000268  2e746f6f
00026c  6c5f6465
000270  6661756c
000274  7400    
000276  00                DCB      0
000277  00                DCB      0
                  |L10.632|
000278  7700              DCB      "w",0
00027a  00                DCB      0
00027b  00                DCB      0
                  |L10.636|
00027c  636f756c          DCB      "could not open output file %s\r\n",0
000280  64206e6f
000284  74206f70
000288  656e206f
00028c  75747075
000290  74206669
000294  6c652025
000298  730d0a00

                          AREA ||i.read_tool_file||, CODE, READONLY, ALIGN=2

                  read_tool_file PROC
;;;351    
;;;352    int read_tool_file(                               /* ARGUMENTS         */
000000  b530              PUSH     {r4,r5,lr}
;;;353    char * file_name)                                 /* name of tool file */
;;;354    {
000002  4602              MOV      r2,r0
;;;355    //    FILE * tool_file_port;
;;;356    //    char buffer[1000];
;;;357    		int slot;
;;;358    //    int tool_id;
;;;359    //    double offset;
;;;360    //    double diameter;
;;;361    //
;;;362    //    if (file_name[0] IS 0)                        /* ask for name if given name is empty string */
;;;363    //    {
;;;364    //        fprintf(stderr, "name of tool file => ");
;;;365    //        gets(buffer);
;;;366    //        tool_file_port SET_TO fopen(buffer, "r");
;;;367    //    }
;;;368    //    else
;;;369    //        tool_file_port SET_TO fopen(file_name, "r");
;;;370    //    if (tool_file_port IS NULL)
;;;371    //    {
;;;372    //        fprintf(stderr, "Cannot open %s\r\n",
;;;373    //            ((file_name[0] IS 0) ? buffer : file_name));
;;;374    //        return 1;
;;;375    //    }
;;;376    //    for(;;)                                       /* read and discard header, checking for blank line */
;;;377    //    {
;;;378    //        if (fgets(buffer, 1000, tool_file_port) IS NULL)
;;;379    //        {
;;;380    //            fprintf(stderr, "Bad tool file format\r\n");
;;;381    //            return 1;
;;;382    //        }
;;;383    //        else if (buffer[0] IS '\n')
;;;384    //            break;
;;;385    //    }
;;;386    //
;;;387    //    for (slot SET_TO 0; slot <= _tool_max; slot++)/* initialize */
;;;388    //    {
;;;389    //        _tools[slot].id SET_TO -1;
;;;390    //        _tools[slot].length SET_TO 0;
;;;391    //        _tools[slot].diameter SET_TO 0;
;;;392    //    }
;;;393    //    for (; (fgets(buffer, 1000, tool_file_port) ISNT NULL); )
;;;394    //    {
;;;395    //        if (sscanf(buffer, "%d %d %lf %lf", &slot,
;;;396    //            &tool_id, &offset, &diameter) < 4)
;;;397    //        {
;;;398    //            fprintf(stderr, "Bad input line \"%s\" in tool file\r\n", buffer);
;;;399    //            return 1;
;;;400    //        }
;;;401    //        if ((slot < 0) OR (slot > _tool_max))     /* zero and max both OK */
;;;402    //        {
;;;403    //            fprintf(stderr, "Out of range tool slot number %d\r\n", slot);
;;;404    //            return 1;
;;;405    //        }
;;;406    //        _tools[slot].id SET_TO tool_id;
;;;407    //        _tools[slot].length SET_TO offset;
;;;408    //        _tools[slot].diameter SET_TO diameter;
;;;409    	    for (slot SET_TO 0; slot <= _tool_max; slot++)/* initialize */
000004  f04f0000          MOV      r0,#0
000008  4601              MOV      r1,r0
00000a  e018              B        |L11.62|
                  |L11.12|
;;;410    	    {
;;;411    	        _tools[slot].id SET_TO -1;
00000c  f04f30ff          MOV      r0,#0xffffffff
000010  eb010341          ADD      r3,r1,r1,LSL #1
000014  4c15              LDR      r4,|L11.108|
000016  f8440033          STR      r0,[r4,r3,LSL #3]
;;;412    	        _tools[slot].length SET_TO 0;
00001a  f04f0300          MOV      r3,#0
00001e  eb010441          ADD      r4,r1,r1,LSL #1
000022  4d12              LDR      r5,|L11.108|
000024  eb0504c4          ADD      r4,r5,r4,LSL #3
000028  60a3              STR      r3,[r4,#8]
00002a  60e3              STR      r3,[r4,#0xc]
;;;413    	        _tools[slot].diameter SET_TO 0;
00002c  eb010441          ADD      r4,r1,r1,LSL #1
000030  eb0504c4          ADD      r4,r5,r4,LSL #3
000034  6123              STR      r3,[r4,#0x10]
000036  6163              STR      r3,[r4,#0x14]
000038  f1010001          ADD      r0,r1,#1              ;409
00003c  4601              MOV      r1,r0                 ;409
                  |L11.62|
00003e  480c              LDR      r0,|L11.112|
000040  6800              LDR      r0,[r0,#0]            ;409  ; _tool_max
000042  4281              CMP      r1,r0                 ;409
000044  dde2              BLE      |L11.12|
;;;414    	    }
;;;415    
;;;416            _tools[5].id SET_TO 5;
000046  f04f0005          MOV      r0,#5
00004a  4b08              LDR      r3,|L11.108|
00004c  6798              STR      r0,[r3,#0x78]  ; _tools
;;;417            _tools[5].length SET_TO 1.5;
00004e  f04f0400          MOV      r4,#0
000052  4b08              LDR      r3,|L11.116|
000054  4805              LDR      r0,|L11.108|
000056  f1000078          ADD      r0,r0,#0x78
00005a  e9c04302          STRD     r4,r3,[r0,#8]
;;;418            _tools[5].diameter SET_TO 0.25;
00005e  4b06              LDR      r3,|L11.120|
000060  e9c04304          STRD     r4,r3,[r0,#0x10]
;;;419    
;;;420    //    }
;;;421    //    fclose(tool_file_port);
;;;422        return 0;
000064  f04f0000          MOV      r0,#0
;;;423    }
000068  bd30              POP      {r4,r5,pc}
;;;424    
                          ENDP

00006a  0000              DCW      0x0000
                  |L11.108|
                          DCD      _tools
                  |L11.112|
                          DCD      _tool_max
                  |L11.116|
                          DCD      0x3ff80000
                  |L11.120|
                          DCD      0x3fd00000

                          AREA ||i.report_error||, CODE, READONLY, ALIGN=2

                          REQUIRE _printf_percent
                          REQUIRE _printf_s
                          REQUIRE _printf_str
                          REQUIRE _printf_str
                          REQUIRE _printf_str
                  report_error PROC
;;;74     
;;;75     void report_error(                                /* ARGUMENTS                            */
000000  b570              PUSH     {r4-r6,lr}
;;;76     int error_code,                                   /* the code number of the error message */
;;;77     int print_stack)                                  /* print stack if ON, otherwise not     */
;;;78     {
000002  b0c0              SUB      sp,sp,#0x100
000004  4606              MOV      r6,r0
000006  460d              MOV      r5,r1
;;;79         char buffer[RS274NGC_TEXT_SIZE];
;;;80         int k;
;;;81     
;;;82         rs274ngc_error_text(error_code, buffer, 5);   /* for coverage of code */
000008  f04f0205          MOV      r2,#5
00000c  4669              MOV      r1,sp
00000e  4630              MOV      r0,r6
000010  f7fffffe          BL       rs274ngc_error_text
;;;83         rs274ngc_error_text(error_code, buffer, RS274NGC_TEXT_SIZE);
000014  f44f7280          MOV      r2,#0x100
000018  4669              MOV      r1,sp
00001a  4630              MOV      r0,r6
00001c  f7fffffe          BL       rs274ngc_error_text
;;;84         fprintf(stderr, "%s\r\n",
000020  f89d0000          LDRB     r0,[sp,#0]
000024  b908              CBNZ     r0,|L12.42|
;;;85             ((buffer[0] IS 0) ? "Unknown error, bad error code" : buffer));
000026  a017              ADR      r0,|L12.132|
000028  e000              B        |L12.44|
                  |L12.42|
00002a  4668              MOV      r0,sp
                  |L12.44|
00002c  4602              MOV      r2,r0
00002e  a11d              ADR      r1,|L12.164|
000030  481e              LDR      r0,|L12.172|
000032  f7fffffe          BL       __2fprintf
;;;86         rs274ngc_line_text(buffer, RS274NGC_TEXT_SIZE);
000036  f44f7180          MOV      r1,#0x100
00003a  4668              MOV      r0,sp
00003c  f7fffffe          BL       rs274ngc_line_text
;;;87         fprintf(stderr, "%s\r\n", buffer);
000040  466a              MOV      r2,sp
000042  a118              ADR      r1,|L12.164|
000044  4819              LDR      r0,|L12.172|
000046  f7fffffe          BL       __2fprintf
;;;88         if (print_stack IS ON)
00004a  2d01              CMP      r5,#1
00004c  d117              BNE      |L12.126|
;;;89         {
;;;90             for (k SET_TO 0; ; k++)
00004e  f04f0400          MOV      r4,#0
000052  bf00              NOP      
                  |L12.84|
;;;91             {
;;;92                 rs274ngc_stack_name(k, buffer, RS274NGC_TEXT_SIZE);
000054  f44f7280          MOV      r2,#0x100
000058  4669              MOV      r1,sp
00005a  4620              MOV      r0,r4
00005c  f7fffffe          BL       rs274ngc_stack_name
;;;93                 if (buffer[0] ISNT 0)
000060  f89d0000          LDRB     r0,[sp,#0]
000064  b128              CBZ      r0,|L12.114|
;;;94                     fprintf(stderr, "%s\r\n", buffer);
000066  466a              MOV      r2,sp
000068  a10e              ADR      r1,|L12.164|
00006a  4810              LDR      r0,|L12.172|
00006c  f7fffffe          BL       __2fprintf
000070  e000              B        |L12.116|
                  |L12.114|
;;;95                 else
;;;96                     break;
000072  e003              B        |L12.124|
                  |L12.116|
000074  f1040001          ADD      r0,r4,#1              ;90
000078  4604              MOV      r4,r0                 ;90
00007a  e7eb              B        |L12.84|
                  |L12.124|
00007c  bf00              NOP      
                  |L12.126|
;;;97             }
;;;98         }
;;;99     }
00007e  b040              ADD      sp,sp,#0x100
000080  bd70              POP      {r4-r6,pc}
;;;100    
                          ENDP

000082  0000              DCW      0x0000
                  |L12.132|
000084  556e6b6e          DCB      "Unknown error, bad error code",0
000088  6f776e20
00008c  6572726f
000090  722c2062
000094  61642065
000098  72726f72
00009c  20636f64
0000a0  6500    
0000a2  00                DCB      0
0000a3  00                DCB      0
                  |L12.164|
0000a4  25730d0a          DCB      "%s\r\n",0
0000a8  00      
0000a9  00                DCB      0
0000aa  00                DCB      0
0000ab  00                DCB      0
                  |L12.172|
                          DCD      __stderr

                          AREA ||.data||, DATA, ALIGN=2

                  _nc_code_buffer
000000  6e303031          DCB      0x6e,0x30,0x30,0x31
000004  30204735          DCB      0x30,0x20,0x47,0x35
000008  30204c32          DCB      0x30,0x20,0x4c,0x32
00000c  20503120          DCB      0x20,0x50,0x31,0x20
000010  5820332e          DCB      0x58,0x20,0x33,0x2e
000014  35205920          DCB      0x35,0x20,0x59,0x20
000018  31372e32          DCB      0x31,0x37,0x2e,0x32
00001c  3b6e3030          DCB      0x3b,0x6e,0x30,0x30
000020  32302047          DCB      0x32,0x30,0x20,0x47
000024  39383b6e          DCB      0x39,0x38,0x3b,0x6e
000028  30303330          DCB      0x30,0x30,0x33,0x30
00002c  20473939          DCB      0x20,0x47,0x39,0x39
000030  3b250000          DCB      0x3b,0x25,0x00,0x00
                  gNowCount
                          DCD      0x00000000
                  _outfile
                          DCD      0x00000000
                  gAllChar
                          DCD      0x00000000
                  HSEStartUpStatus
000040  00                DCB      0x00
